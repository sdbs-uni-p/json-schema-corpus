{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "version": "1.15.1",
  "title": "Bestiary Schema",
  "$id": "bestiary.json",
  "type": "object",
  "definitions": {
    "align": {
      "oneOf": [
        {
          "type": "string",
          "enum": [
            "L",
            "N",
            "NX",
            "NY",
            "C",
            "G",
            "E",
            "U",
            "A"
          ]
        },
        {
          "type": "object",
          "properties": {
            "alignment": {
              "type": "array",
              "items": {
                "$ref": "#/definitions/align"
              }
            },
            "chance": {
              "type": "integer"
            },
            "note": {
              "type": "string"
            }
          },
          "additionalProperties": false,
          "required": [
            "alignment"
          ]
        },
        {
          "type": "object",
          "properties": {
            "special": {
              "type": "string"
            }
          },
          "additionalProperties": false,
          "required": [
            "special"
          ]
        }
      ]
    },
    "acItem": {
      "oneOf": [
        {
          "type": "object",
          "properties": {
            "ac": {
              "type": "integer"
            },
            "from": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "condition": {
              "type": "string"
            },
            "braces": {
              "type": "boolean"
            }
          },
          "required": [
            "ac"
          ],
          "additionalProperties": false
        },
        {
          "type": "object",
          "properties": {
            "special": {
              "type": "string"
            }
          },
          "required": [
            "special"
          ],
          "additionalProperties": false
        },
        {
          "type": "integer"
        }
      ]
    },
    "creatureData": {
      "type": "object",
      "properties": {
        "name": {
          "type": "string"
        },
        "shortName": {
          "oneOf": [
            {
              "description": "Used anywhere a shortened form of the creatures name is required (e.g. in legendary action headers). If not supplied, a shortened name will be automatically generated from the creature's full name.",
              "type": "string"
            },
            {
              "description": "As above, but \"true\" if the \"shortName\" should be an exact copy of the creature's \"name\".",
              "type": "boolean"
            }
          ]
        },
        "alias": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "group": {
          "description": "A group name, indexed by search. E.g. searching \"Lycanthrope\" would otherwise fail to find anything",
          "type": [
            "string",
            "null"
          ]
        },
        "level": {
          "description": "Used in sidekicks, which can have levels (and generally do not have alignment)",
          "type": "integer"
        },
        "size": {
          "type": "string",
          "enum": [
            "F",
            "D",
            "T",
            "S",
            "M",
            "L",
            "H",
            "G",
            "C",
            "V"
          ]
        },
        "sizeNote": {
          "type": "string"
        },
        "type": {
          "oneOf": [
            {
              "type": "object",
              "properties": {
                "type": {
                  "$ref": "util.json#/definitions/creatureType"
                },
                "swarmSize": {
                  "type": "string",
                  "enum": [
                    "F",
                    "D",
                    "T",
                    "S",
                    "M",
                    "L",
                    "H",
                    "G",
                    "C",
                    "V"
                  ]
                },
                "tags": {
                  "type": "array",
                  "uniqueItems": true,
                  "items": {
                    "oneOf": [
                      {
                        "type": "string"
                      },
                      {
                        "type": "object",
                        "properties": {
                          "tag": {
                            "type": "string"
                          },
                          "prefix": {
                            "type": "string"
                          }
                        },
                        "required": [
                          "tag",
                          "prefix"
                        ],
                        "additionalProperties": false
                      }
                    ]
                  }
                }
              },
              "required": [
                "type"
              ],
              "additionalProperties": false
            },
            {
              "$ref": "util.json#/definitions/creatureType"
            }
          ]
        },
        "source": {
          "type": "string"
        },
        "otherSources": {
          "$ref": "util.json#/definitions/otherSources"
        },
        "externalSources": {
          "description": "For homebrew use only.",
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "entry": {
                "$ref": "entry.json"
              }
            },
            "required": [
              "entry"
            ],
            "additionalProperties": false
          }
        },
        "alignment": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/align"
          }
        },
        "ac": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/acItem"
          }
        },
        "hp": {
          "oneOf": [
            {
              "type": "object",
              "properties": {
                "average": {
                  "type": "integer"
                },
                "formula": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            },
            {
              "type": "object",
              "properties": {
                "special": {
                  "type": "string"
                }
              },
              "additionalProperties": false
            }
          ]
        },
        "speed": {
          "$ref": "util.json#/definitions/speed"
        },
        "str": {
          "type": "integer"
        },
        "dex": {
          "type": "integer"
        },
        "con": {
          "type": "integer"
        },
        "int": {
          "type": "integer"
        },
        "wis": {
          "type": "integer"
        },
        "cha": {
          "type": "integer"
        },
        "save": {
          "type": "object",
          "properties": {
            "str": {
              "type": "string"
            },
            "dex": {
              "type": "string"
            },
            "con": {
              "type": "string"
            },
            "int": {
              "type": "string"
            },
            "wis": {
              "type": "string"
            },
            "cha": {
              "type": "string"
            },
            "special": {
              "description": "For use in homebrew.",
              "$ref": "entry.json"
            }
          },
          "additionalProperties": false
        },
        "skill": {
          "type": "object",
          "properties": {
            "acrobatics": {
              "type": "string"
            },
            "animal handling": {
              "type": "string"
            },
            "arcana": {
              "type": "string"
            },
            "athletics": {
              "type": "string"
            },
            "deception": {
              "type": "string"
            },
            "history": {
              "type": "string"
            },
            "insight": {
              "type": "string"
            },
            "intimidation": {
              "type": "string"
            },
            "investigation": {
              "type": "string"
            },
            "medicine": {
              "type": "string"
            },
            "nature": {
              "type": "string"
            },
            "perception": {
              "type": "string"
            },
            "performance": {
              "type": "string"
            },
            "persuasion": {
              "type": "string"
            },
            "religion": {
              "type": "string"
            },
            "sleight of hand": {
              "type": "string"
            },
            "stealth": {
              "type": "string"
            },
            "survival": {
              "type": "string"
            },
            "other": {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "oneOf": {
                    "type": "object",
                    "acrobatics": {
                      "type": "string"
                    },
                    "animal handling": {
                      "type": "string"
                    },
                    "arcana": {
                      "type": "string"
                    },
                    "athletics": {
                      "type": "string"
                    },
                    "deception": {
                      "type": "string"
                    },
                    "history": {
                      "type": "string"
                    },
                    "insight": {
                      "type": "string"
                    },
                    "intimidation": {
                      "type": "string"
                    },
                    "investigation": {
                      "type": "string"
                    },
                    "medicine": {
                      "type": "string"
                    },
                    "nature": {
                      "type": "string"
                    },
                    "perception": {
                      "type": "string"
                    },
                    "performance": {
                      "type": "string"
                    },
                    "persuasion": {
                      "type": "string"
                    },
                    "religion": {
                      "type": "string"
                    },
                    "sleight of hand": {
                      "type": "string"
                    },
                    "stealth": {
                      "type": "string"
                    },
                    "survival": {
                      "type": "string"
                    }
                  }
                }
              }
            },
            "special": {
              "description": "For use in homebrew.",
              "$ref": "entry.json"
            }
          },
          "additionalProperties": false
        },
        "senses": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "passive": {
          "type": "integer"
        },
        "languages": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "cr": {
          "oneOf": [
            {
              "type": "string"
            },
            {
              "type": "object",
              "properties": {
                "cr": {
                  "type": "string"
                },
                "lair": {
                  "type": "string"
                },
                "coven": {
                  "type": "string"
                }
              },
              "additionalProperties": false,
              "required": [
                "cr"
              ]
            }
          ]
        },
        "vulnerable": {
          "$ref": "util.json#/definitions/damageVulnerabilityArray"
        },
        "resist": {
          "$ref": "util.json#/definitions/damageResistArray"
        },
        "immune": {
          "$ref": "util.json#/definitions/damageImmunityArray"
        },
        "conditionImmune": {
          "$ref": "util.json#/definitions/conditionImmunityArray"
        },
        "spellcasting": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "$ref": "entry.json#/definitions/entrySpellcasting"
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "trait": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "entries": {
                    "type": "array",
                    "items": {
                      "$ref": "entry.json"
                    }
                  },
                  "type": {
                    "type": "string",
                    "enum": [
                      "entries",
                      "inset"
                    ]
                  },
                  "sort": {
                    "description": "Forces a sort order. Traits with sort orders will always be arranged before those without.",
                    "type": "integer"
                  }
                },
                "required": [
                  "name",
                  "entries"
                ],
                "additionalProperties": false
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "actionNote": {
          "type": "string"
        },
        "action": {
          "oneOf": [
            {
              "type": "array",
              "items": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "entries": {
                    "type": "array",
                    "items": {
                      "$ref": "entry.json"
                    }
                  }
                },
                "required": [
                  "name",
                  "entries"
                ],
                "additionalProperties": false
              }
            },
            {
              "type": "null"
            }
          ]
        },
        "reaction": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "entries": {
                "type": "array",
                "items": {
                  "$ref": "entry.json"
                }
              }
            },
            "required": [
              "name",
              "entries"
            ],
            "additionalProperties": false
          }
        },
        "legendaryGroup": {
          "type": "object",
          "properties": {
            "name": {
              "type": "string"
            },
            "source": {
              "type": "string"
            }
          }
        },
        "legendaryActions": {
          "type": "number"
        },
        "legendaryHeader": {
          "type": "array",
          "items": {
            "$ref": "entry.json"
          }
        },
        "legendary": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "entries": {
                "type": "array",
                "items": {
                  "$ref": "entry.json"
                }
              }
            },
            "required": [
              "entries"
            ],
            "additionalProperties": false
          }
        },
        "mythicHeader": {
          "type": "array",
          "items": {
            "$ref": "entry.json"
          }
        },
        "mythic": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "entries": {
                "type": "array",
                "items": {
                  "$ref": "entry.json"
                }
              }
            },
            "required": [
              "entries"
            ],
            "additionalProperties": false
          }
        },
        "variant": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "type": {
                "type": "string"
              },
              "name": {
                "type": "string"
              },
              "entries": {
                "type": "array",
                "items": {
                  "$ref": "entry.json"
                }
              },
              "token": {
                "type": "object",
                "properties": {
                  "name": {
                    "type": "string"
                  },
                  "source": {
                    "type": "string"
                  },
                  "page": {
                    "type": "integer"
                  }
                },
                "required": [
                  "name",
                  "source"
                ]
              },
              "variantSource": {
                "type": "object",
                "properties": {
                  "source": {
                    "type": "string"
                  },
                  "page": {
                    "type": "integer"
                  }
                }
              }
            },
            "additionalProperties": false
          }
        },
        "page": {
          "type": "integer"
        },
        "familiar": {
          "type": "boolean"
        },
        "additionalSources": {
          "$ref": "util.json#/definitions/additionalSources"
        },
        "hasToken": {
          "type": "boolean"
        },
        "tokenUrl": {
          "type": "string"
        },
        "altArt": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string"
              },
              "source": {
                "type": "string"
              },
              "page": {
                "type": "integer"
              }
            },
            "required": [
              "name",
              "source"
            ]
          }
        },
        "fluff": {
          "description": "This is intended to be used for Homebrew only - site data should include a fluff file per source",
          "oneOf": [
            {
              "type": "object",
              "properties": {
                "entries": {
                  "type": "array",
                  "items": {
                    "$ref": "entry.json"
                  }
                },
                "images": {
                  "type": "array",
                  "items": {
                    "$ref": "entry.json#/definitions/entryImage"
                  }
                }
              }
            },
            {
              "description": "Reference \"monsterFluff\" array items",
              "type": "object",
              "properties": {
                "_monsterFluff": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "source": {
                      "type": "string"
                    }
                  }
                },
                "_appendMonsterFluff": {
                  "type": "object",
                  "properties": {
                    "name": {
                      "type": "string"
                    },
                    "source": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          ]
        },
        "isNamedCreature": {
          "type": "boolean"
        },
        "isNpc": {
          "description": "Used to flag adventure NPCs",
          "type": "boolean"
        },
        "environment": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "underwater",
              "coastal",
              "mountain",
              "grassland",
              "hill",
              "arctic",
              "urban",
              "forest",
              "swamp",
              "underdark",
              "desert"
            ]
          }
        },
        "soundClip": {
          "$ref": "entry.json#/definitions/mediaHref"
        },
        "dragonCastingColor": {
          "type": "string",
          "enum": [
            "B",
            "U",
            "G",
            "R",
            "W",
            "A",
            "Z",
            "C",
            "O",
            "S"
          ]
        },
        "traitTags": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "Aggressive",
              "Ambusher",
              "Amorphous",
              "Amphibious",
              "Antimagic Susceptibility",
              "Brute",
              "Charge",
              "Damage Absorption",
              "Death Burst",
              "Devil's Sight",
              "False Appearance",
              "Fey Ancestry",
              "Flyby",
              "Hold Breath",
              "Illumination",
              "Immutable Form",
              "Incorporeal Movement",
              "Keen Senses",
              "Legendary Resistances",
              "Light Sensitivity",
              "Magic Resistance",
              "Magic Weapons",
              "Pack Tactics",
              "Pounce",
              "Rampage",
              "Reckless",
              "Regeneration",
              "Rejuvenation",
              "Shapechanger",
              "Siege Monster",
              "Sneak Attack",
              "Spider Climb",
              "Sunlight Sensitivity",
              "Turn Immunity",
              "Turn Resistance",
              "Undead Fortitude",
              "Water Breathing",
              "Web Sense",
              "Web Walker"
            ]
          }
        },
        "actionTags": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "Frightful Presence",
              "Multiattack",
              "Parry",
              "Swallow",
              "Teleport",
              "Tentacles"
            ]
          }
        },
        "languageTags": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "AB",
              "AQ",
              "AU",
              "C",
              "CE",
              "CS",
              "D",
              "DR",
              "DS",
              "DU",
              "E",
              "G",
              "GI",
              "GO",
              "GTH",
              "H",
              "I",
              "IG",
              "LF",
              "O",
              "OTH",
              "P",
              "S",
              "T",
              "TC",
              "TP",
              "U",
              "X",
              "XX"
            ]
          }
        },
        "senseTags": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "B",
              "D",
              "SD",
              "T",
              "U"
            ]
          }
        },
        "spellcastingTags": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "P",
              "I",
              "F",
              "S",
              "CB",
              "CC",
              "CD",
              "CP",
              "CR",
              "CS",
              "CL",
              "CW"
            ]
          }
        },
        "damageTags": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "A",
              "B",
              "C",
              "F",
              "O",
              "L",
              "N",
              "P",
              "I",
              "Y",
              "R",
              "S",
              "T"
            ]
          }
        },
        "miscTags": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "MW",
              "RW",
              "RCH",
              "THW",
              "RNG",
              "AOE"
            ]
          }
        },
        "conditionInflict": {
          "$ref": "util.json#/definitions/tagsConditions"
        },
        "conditionInflictLegendary": {
          "$ref": "util.json#/definitions/tagsConditions"
        },
        "conditionInflictSpell": {
          "$ref": "util.json#/definitions/tagsConditions"
        },
        "footer": {
          "description": "Intended for homebrew use only.",
          "type": "array",
          "items": {
            "$ref": "entry.json"
          }
        },
        "srd": {
          "$ref": "util.json#/definitions/srd"
        }
      },
      "additionalProperties": false
    },
    "creature": {
      "anyOf": [
        {
          "type": "object",
          "$$merge": [
            {
              "$ref": "#/definitions/creatureData"
            },
            {
              "required": [
                "name",
                "size",
                "type",
                "source",
                "ac",
                "hp",
                "speed",
                "str",
                "dex",
                "con",
                "int",
                "wis",
                "cha",
                "passive"
              ]
            }
          ]
        },
        {
          "type": "object",
          "$comment": "This is a custom pre-processor tag, which merges together the array of objects into one. This allows proper inheritance, which JSON schema don't really do.",
          "$$merge": [
            {
              "$ref": "#/definitions/creatureData"
            },
            {
              "$ref": "util.json#/definitions/copyBlock"
            }
          ]
        }
      ]
    }
  },
  "properties": {
    "monster": {
      "type": "array",
      "uniqueItems": true,
      "items": {
        "$ref": "#/definitions/creature"
      }
    },
    "_meta": {
      "$ref": "util.json#/definitions/metaBlock"
    }
  },
  "additionalProperties": false
}